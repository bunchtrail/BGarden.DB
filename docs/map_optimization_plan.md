# План оптимизации структуры карт и устранения дублирования

## Выявленные проблемы

1. **Дублирование полей координат в MapLayer**:

   - Свойство `Bounds` типа `Envelope` не сохраняется в БД
   - Вместо этого используются отдельные поля `MinX`, `MinY`, `MaxX`, `MaxY`
   - Это усложняет код и может привести к несогласованности данных

2. **Пересечение функциональности между сервисами**:

   - `MapService` и `MapTileService` имеют некоторое пересечение в работе с слоями карты
   - Необходимо четко разделить ответственность и убрать дублирование

3. **Устаревшие методы в API**:
   - В интерфейсе `IMapService` есть методы для работы с `MapArea`, но соответствующая таблица была удалена в миграции
   - Эти методы не имеют полной реализации в `MapService`

## План оптимизации

### 1. Оптимизация сущности MapLayer

1. Удалить поле `Bounds` из `MapLayer` и оставить только конкретные поля координат
2. Добавить метод в MapLayer для создания Envelope на основе координатных полей (не хранить в БД)
3. Обновить все зависимые сервисы и репозитории для использования этого подхода

### 2. Устранение неиспользуемых методов и сущностей

1. Удалить все методы работы с `MapArea` из интерфейса `IMapService` и его реализации
2. Удалить связанные DTO и модели маппинга для `MapArea`
3. Создать новую миграцию для очистки структуры БД

### 3. Разделение ответственности между сервисами

1. `MapService` - основная работа с картой, маркерами и настройками
2. `MapTileService` - работа исключительно с тайлами и слоями карты
3. Обновить интерфейсы и реализации для четкого разделения ответственности

### 4. Консолидация миграций

1. Создать новую "чистую" миграцию, которая объединит все предыдущие изменения
2. Удалить ненужные колонки и таблицы из структуры БД
3. Обновить конфигурации Entity Framework для соответствия новой структуре

## Последовательность действий

1. Обновить модели Domain
2. Обновить интерфейсы сервисов
3. Обновить реализации сервисов
4. Создать новую миграцию
5. Обновить репозитории
6. Обновить конфигурации Entity Framework
